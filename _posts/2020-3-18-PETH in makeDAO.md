---
layout:     post
title:      PETH in makeDAO
subtitle:   
date:       2020-3-18
author:     Howard
header-img: img/post_blockchain.jpg
catalog: false
tags:
    - MakerDAO
    - blockchain
    - ethereum
---



makeDAO is a fist product of Ethereum deFi. The DAI generated by it is locked in one dollar. Currently, Ethereum is used as the collateral in the first stage to imitate the debt currency model. Users can mortgage their ether to their smart contract CDP (collateral deposit position), and then it generates DAI as a debt currency to users. Of course, it is not for nothing. There are too many articles about this process on the Internet, and I don't want to waste any time. At first, I felt that it was too long to read the English white paper. I did n’t think about it, and I did n’t have time (in fact, all excuses) to read it. Although this thing will be cancelled in the second stage, I personally think that due to the technical problems of the side chain, it is not known that it is the year of the monkey, so it is very unpleasant, so I got the original white paper again and studied it. The concept of things became clear.

Let's streamline this process. The user has some ether at hand and lacks money to buy more coins, so he (right and use him, there is no meaning of sexism) will bring these 10 ether (assuming a market price of $ 200) to makerDAO CDP is pledged on the website. Due to risk control, CDP has a limitation called 'Liquidation Ratio', and users can only get DAI of 1,500 knives. In the mortgage process, ETH is first replaced with WETH (because ETH is not an ERC20 coin, and smart contracts are not easy to control, it is packaged as WETH that meets the ERCD20 standard). WETH and ETH have a 1: 1 relationship. The user's ETH enters an ETH pool, and CDP exchanges an equal amount of PETH to the user, and at the same time gives the user DAI. This PETH cannot be traded outside, it represents only the ownership of the collateral, and it is an internal variable of the makerDAO system.

In this way, makerDAO is equivalent to a bank that accepts collateral (ETH) and then prints banknotes (DAI). It must ensure that the market value of the collateral is greater than or equal to the debt currency sent. When the market price of collateral rises all the way, then users use DAI to exchange back to ETH, and this bank has no problem. However, when the price of the collateral falls, it falls below the limit set by the system, that is, when the 'Liquidation Ratio', MAKEDAO must clear the user. This has the same reason as the futures contract. You either return DAI or increase The collateral, otherwise it will be liquidated.

The liquidation involves the system role of keeper and CDP users, as well as PETH and DAI. The system will hand over this process to a smart contract called "Liquidity Providing Contract". This process uses PETH to sell to the keeper, in exchange for DAI, and then the system destroys the DAI. In this way, the user's collateral is deducted from the amount of DAI generated by the user, the stability fee (Stability Fee), the liquidation penalty fee (Liquidation Penalty), and the remaining ETH is returned to the user, and the CDP is closed. If more PETH is sold, then the resulting DAI is used to buy excess PETH and then destroy it. In this way, the balance between the number of DAI and DAI on the market is dynamically maintained.

So when the price of the collateral Ethereum falls below the market value of the debt currency issued outside, users will run for it? The system needs to guarantee that each DAI is worth $ 1! The makerDAO platform will automatically generate PETH immediately to ensure that the value of the collateral is above the market value of DAI. This PETH is generated out of thin air, and the amount generated is determined by the value of the collateral and the market value of the DAI issued. Then the price of a single PETH is reduced. However, when someone seemed to pay for the PETH generated out of thin air, it was the CDP user who paid for it. Any CDP user is deducted a fee when they are accidentally liquidated, which is called Liquidation Penalty. The user is deducted and liquidated. After the punishment, the excess ETH is returned to the user. This Liquidation Penalty is used to purchase PETH and then destroy it, thus reducing the amount of PETH.

So I think that this PETH is essentially a liquidation penalty fee that the system usually charges to fill the collateral to ensure that the value of the collateral is not less than the market value of DAI. In this way, when global liquidation occurs unfortunately, each DAI of the user can really be worth $ 1 , Can get ETH worth 1 dollar.

Finally, as a digression, regarding the MKR token, it is a management token of the entire system. The number is fixed. In addition to the holders can vote on system parameters and smart contracts, the benefit is the stability fee paid by each CDP user when closing CDP. Both use MKR to pay, and the system destroys MKR when it is received, so it becomes a scarce and deflationary currency. I ca n’t quite understand this point. Why not just use the DAI to measure the stability fee, but it will be automatically deducted in the system according to ETH, and the deduction will be placed in a large pool and distributed to all MKR holders like dividends.



makeDAO可是以太坊deFi的拳头产品，它产生的DAI锁定一美元，目前第一阶段就以以太坊为抵押，模仿债务货币模式。 用户可以把自己的以太币抵押给它的智能合约CDP ( collateral deposit position )，然后它就产生DAI这个债务货币给用户。当然也不是白给，关于这个过程的文章，网上实在太多，我不想费口舌了。一开始我看英文白皮书感觉太长，没心思，也没时间（其实都是借口）看下去，于是找很多中文资料在手机上有事没事就看，但是一直就没弄懂PETH到底有啥用，尽管这个东西在第二阶段要取消，但是我个人认为，由于侧链技术问题，那不知道是猴年马月的事情，于是如鲠在喉，非常不爽，重新找来原汁白皮书，研究起来，总算脑袋里对这个东西的概念清晰起来。

咱把这个过程理理顺，用户手头有些以太币，缺钱买更多币，于是他（权且用他，没有性别歧视的意思）就把这10个以太币（假设市场价格200 刀）到makerDAO的网站上抵押到CDP，由于存在风险控制，CDP有一个叫做‘Liquidation​ ​Ratio’的限制，用户只能拿到1500刀的DAI。在抵押过程种，ETH先是被换成WETH （因为ETH本身不是ERC20的币，智能合约不好控制，所以就给包装成满足ERCD20标准的WETH），WETH跟ETH是1：1关系。 用户的ETH进入一个ETH池子，CDP兑换同等数量的PETH给用户，同时给用户DAI，这个PETH在外界是不能交易的，它代表的仅仅是抵押物的所有权，它是makerDAO系统的内部变量。

这样一来，makerDAO就相当于一个银行，接受抵押物（ETH），然后印钞票（DAI），它必须保证抵押物的市场价值大于或等于发去出的债务货币。当抵押物市场价格一路上升，那么用户拿DAI去兑换回ETH，这个银行没有问题。 但是当抵押物价格出现下跌时，跌破系统设定的界限，就是那个‘Liquidation​ ​Ratio'的时候，MAKEDAO就要对用户进行清算，这个跟期货合约一个道理，你要么返回DAI，要么增加抵押物，否则就要接受清算。

清算涉及到keeper 这个系统角色和CDP用户，还涉及到PETH和DAI，系统会把这个过程交给一个叫做“Liquidity Providing Contract”的智能合约去做。 这个过程是用PETH拿去卖给keeper，换取DAI，然后系统把DAI销毁掉。这样把用户抵押物扣除用户生成的DAI的数量和稳定费（Stability Fee），清算惩罚费（Liquidation Penalty），剩下的ETH还给用户，CDP被关闭掉。如果多卖了PETH，那么多得到的DAI被用于买入多余的PETH，然后销毁掉。如此动态保持PETH和市场上DAI数量的平衡。

那么当抵押物以太币价格跌到比发行在外面的债务货币市值还小的时候，用户都来挤兑咋办？系统需要保证每个DAI都值1美元！ makerDAO 平台会马上自动生成PETH来保证抵押物价值在DAI的市值之上，这个PETH是凭空生成的，其生成的数量由抵押物价值和发行在外的DAI的市值来决定。那么单个PETH的价格就降低了。但是这个看似凭空生成的PETH时候有人来买单的，买单的就是CDP用户，任何CDP用户在不小心被清算时候，都要被扣除一笔费用，叫做Liquidation Penalty（清算惩罚），用户被扣除清算惩罚后多余ETH才被返回给用户，这个Liquidation Penalty是用来购买PETH，然后销毁它，这样就减少了PETH的数量。

所以我觉得这个PETH本质上是系统平时收取的清算惩罚费来填补抵押物来保证抵押物价值不小于DAI的市值，如此，在不幸发生全局清算时候，用户的每个DAI能真的值1美元，能得到价值1美元的ETH。

最后说个题外话，关于MKR这个token，它是整个系统的管理型代币，数量固定，除了持有人能对系统参数和智能合约投票，好处就是每个CDP用户关闭CDP时候缴纳的稳定费都要用MKR去支付，系统收到MKR就销毁掉，如此它就变成紧缺并且通缩的货币了。这点我相当不能理解，为啥不干脆一点，稳定费也用DAI来计量，但是按ETH在系统里自动扣除，扣除部分放一个大池子里，像分红利一样分给所有MKR持有人。

